<div ng-controller="bulkUploadController" class="bulk-upload-dashboard">
    <!-- Page Header -->
    <div class="page-header">
        <div>
            <h1>Bulk Upload</h1>
            <p>Import content and media into your Umbraco site in bulk via CSV or ZIP files.</p>
            <div class="header-badge">
                <span class="dot"></span>
                Ready to import
            </div>
        </div>
    </div>

    <!-- Tab Navigation -->
    <uui-tab-group style="margin-bottom: 28px;">
        <uui-tab label="Content Import"
                 ng-click="setActiveTab('content')"
                 ng-attr-active="{{state.activeTab === 'content' ? 'true' : undefined}}">
            Content Import
        </uui-tab>
        <uui-tab label="Media Import"
                 ng-click="setActiveTab('media')"
                 ng-attr-active="{{state.activeTab === 'media' ? 'true' : undefined}}">
            Media Import
        </uui-tab>
    </uui-tab-group>

    <!-- Content Import Panel -->
    <div ng-show="state.activeTab === 'content'" class="tab-panel">
        <!-- Results Section -->
        <div class="upload-card" ng-if="state.content.results && !state.content.loading">
            <div class="card-header">
                <div class="icon-circle green">‚úì</div>
                <div>
                    <h2>Import Results</h2>
                    <span class="subtitle">Summary of your content import</span>
                </div>
            </div>
            <div class="card-body">
                <div class="results-summary">
                    <div class="badge badge-total">
                        <strong>Total:</strong> {{state.content.results.totalCount}}
                    </div>
                    <div class="badge badge-success">
                        <strong>‚úì Success:</strong> {{state.content.results.successCount}}
                    </div>
                    <div ng-if="state.content.results.failureCount > 0" class="badge badge-failed">
                        <strong>‚úó Failed:</strong> {{state.content.results.failureCount}}
                    </div>
                </div>

                <div style="display: flex; gap: 10px;">
                    <uui-button label="Download Results CSV"
                                look="outline"
                                ng-click="onExportContentResultsClicked()"
                                ng-if="state.content.results.results && state.content.results.results.length > 0"
                                style="--uui-button-padding: 10px 20px;">
                        ‚¨á Download Results CSV
                    </uui-button>
                    <uui-button label="Clear Results"
                                look="outline"
                                ng-click="clearContentResults()"
                                style="--uui-button-padding: 10px 20px;">
                        Clear Results
                    </uui-button>
                </div>
            </div>
        </div>

        <!-- Upload Card -->
        <div class="upload-card">
            <div class="card-header">
                <div class="icon-circle green">‚ñ≤</div>
                <div>
                    <h2>Upload File</h2>
                    <span class="subtitle">Automatically detects content or media imports</span>
                </div>
            </div>
            <div class="card-body">
                <!-- Drop Zone -->
                <div class="drop-zone" ng-click="triggerFileInput('content')" ng-if="!state.content.file">
                    <div class="upload-icon">‚ñ≤</div>
                    <h3>Drag files here or <em>browse</em></h3>
                    <p>File type will be automatically detected</p>
                    <div class="file-types">
                        <span class="file-chip">.csv</span>
                        <span class="file-chip">.zip</span>
                    </div>
                </div>

                <!-- File Preview -->
                <div class="file-preview" ng-if="state.content.file && !state.content.loading">
                    <div class="file-icon">üìÑ</div>
                    <div class="file-details">
                        <div class="file-name">{{state.content.file.name}}</div>
                        <div class="file-size">{{formatFileSize(state.content.file.size)}}</div>
                        <div class="detected-type" ng-if="state.content.detectedImportType">
                            <span class="type-badge content-badge" ng-if="state.content.detectedImportType === 'content'">üìù Content Import</span>
                            <span class="type-badge media-badge" ng-if="state.content.detectedImportType === 'media'">üñº Media Import</span>
                            <span class="type-badge unknown-badge" ng-if="state.content.detectedImportType === 'unknown'">‚ùì Unknown Type</span>
                        </div>
                    </div>
                    <uui-button label="Clear"
                                look="outline"
                                ng-click="clearContentFile()">
                        Clear
                    </uui-button>
                </div>

                <!-- Hidden File Input -->
                <input type="file"
                       id="content-file-input"
                       ngf-select
                       ng-model="bulkUploadImportFile"
                       ng-change="onFileSelected(bulkUploadImportFile, $event)"
                       ng-disabled="state.content.loading"
                       accept=".csv,.zip" />

                <!-- Import Button -->
                <div class="btn-container">
                    <uui-button ng-attr-label="{{state.content.detectedImportType === 'content' ? 'Import Content' : state.content.detectedImportType === 'media' ? 'Import Media' : 'Import File'}}"
                                look="primary"
                                color="positive"
                                ng-click="onUploadClicked()"
                                ng-disabled="!state.content.file || state.content.loading"
                                style="--uui-button-padding: 12px 28px;">
                        <span ng-if="!state.content.loading && state.content.detectedImportType === 'content'">‚ñ≤ Import Content</span>
                        <span ng-if="!state.content.loading && state.content.detectedImportType === 'media'">‚ñ≤ Import Media</span>
                        <span ng-if="!state.content.loading && (!state.content.detectedImportType || state.content.detectedImportType === 'unknown')">‚ñ≤ Import File</span>
                        <span ng-if="state.content.loading">Processing...</span>
                    </uui-button>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div ng-if="state.content.loading" class="loading-state">
            <uui-loader-bar style="color: #006eff"></uui-loader-bar>
            <p>Importing content, please wait...</p>
        </div>

        <!-- Requirements Card -->
        <div class="requirements-card" ng-if="!state.content.loading">
            <div class="card-header">
                <div class="icon-circle blue">‚Ñπ</div>
                <div>
                    <h2>Requirements & Help</h2>
                    <span class="subtitle">Everything you need to format your import file correctly</span>
                </div>
            </div>
            <div class="card-body">
                <!-- Required CSV Columns -->
                <div class="req-section">
                    <div class="req-label">Required CSV Columns</div>
                    <div class="req-grid">
                        <div class="req-item">
                            <code>parent</code>
                            <div class="desc">Parent ID, GUID, or content path</div>
                            <div class="examples">
                                <span>1050</span>
                                <span>71332aa7-‚Ä¶</span>
                                <span>/news/2024/</span>
                            </div>
                        </div>
                        <div class="req-item">
                            <code>docTypeAlias</code>
                            <div class="desc">Content type alias</div>
                            <div class="examples">
                                <span>articlePage</span>
                            </div>
                        </div>
                        <div class="req-item">
                            <code>name</code>
                            <div class="desc">Content item name</div>
                            <div class="examples">
                                <span>My Article</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Media Files -->
                <div class="req-section">
                    <div class="req-label">Media Files</div>
                    <div class="media-tips">
                        <div class="media-tip">
                            <div class="tip-icon">‚ñ≤</div>
                            Upload a <strong>ZIP file</strong> to include media with your content
                        </div>
                        <div class="media-tip">
                            <div class="tip-icon">üñº</div>
                            Reference media using resolvers like <code>heroImage|zipFileToMedia</code>
                        </div>
                        <div class="media-tip">
                            <div class="tip-icon">üë•</div>
                            Supports multi-CSV imports with automatic media deduplication
                        </div>
                        <div class="media-tip">
                            <div class="tip-icon">üìÑ</div>
                            Add extra CSV columns for any property on your doc type
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Media Import Panel -->
    <div ng-show="state.activeTab === 'media'" class="tab-panel">
        <!-- Results Section -->
        <div class="upload-card" ng-if="state.media.results && !state.media.loading">
            <div class="card-header">
                <div class="icon-circle green">‚úì</div>
                <div>
                    <h2>Import Results</h2>
                    <span class="subtitle">Summary of your media import</span>
                </div>
            </div>
            <div class="card-body">
                <div class="results-summary">
                    <div class="badge badge-total">
                        <strong>Total:</strong> {{state.media.results.totalCount}}
                    </div>
                    <div class="badge badge-success">
                        <strong>‚úì Success:</strong> {{state.media.results.successCount}}
                    </div>
                    <div ng-if="state.media.results.failureCount > 0" class="badge badge-failed">
                        <strong>‚úó Failed:</strong> {{state.media.results.failureCount}}
                    </div>
                </div>

                <div style="display: flex; gap: 10px;">
                    <uui-button label="Download Results CSV"
                                look="outline"
                                ng-click="onExportResultsClicked()"
                                ng-if="state.media.results.results && state.media.results.results.length > 0"
                                style="--uui-button-padding: 10px 20px;">
                        ‚¨á Download Results CSV
                    </uui-button>
                    <uui-button label="Clear Results"
                                look="outline"
                                ng-click="clearMediaResults()"
                                style="--uui-button-padding: 10px 20px;">
                        Clear Results
                    </uui-button>
                </div>
            </div>
        </div>

        <!-- Upload Card -->
        <div class="upload-card">
            <div class="card-header">
                <div class="icon-circle green">‚ñ≤</div>
                <div>
                    <h2>Upload File</h2>
                    <span class="subtitle">Drag & drop or browse for your media import file</span>
                </div>
            </div>
            <div class="card-body">
                <!-- Drop Zone -->
                <div class="drop-zone" ng-click="triggerFileInput('media')" ng-if="!state.media.file">
                    <div class="upload-icon">‚ñ≤</div>
                    <h3>Drag files here or <em>browse</em></h3>
                    <p>Select a ZIP or CSV file to start your media import</p>
                    <div class="file-types">
                        <span class="file-chip">.csv</span>
                        <span class="file-chip">.zip</span>
                    </div>
                </div>

                <!-- File Preview -->
                <div class="file-preview" ng-if="state.media.file && !state.media.loading">
                    <div class="file-icon">üìÑ</div>
                    <div class="file-details">
                        <div class="file-name">{{state.media.file.name}}</div>
                        <div class="file-size">{{formatFileSize(state.media.file.size)}}</div>
                    </div>
                    <uui-button label="Clear"
                                look="outline"
                                ng-click="clearMediaFile()">
                        Clear
                    </uui-button>
                </div>

                <!-- Hidden File Input -->
                <input type="file"
                       id="media-file-input"
                       ngf-select
                       ng-model="mediaUploadFile"
                       ng-change="onMediaFileSelected(mediaUploadFile, $event)"
                       ng-disabled="state.media.loading"
                       accept=".zip,.csv" />

                <!-- Import Button -->
                <div class="btn-container">
                    <uui-button label="Import Media"
                                look="primary"
                                color="positive"
                                ng-click="onMediaUploadClicked()"
                                ng-disabled="!state.media.file || state.media.loading"
                                style="--uui-button-padding: 12px 28px;">
                        <span ng-if="!state.media.loading">‚ñ≤ Import Media</span>
                        <span ng-if="state.media.loading">Processing...</span>
                    </uui-button>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div ng-if="state.media.loading" class="loading-state">
            <uui-loader-bar style="color: #006eff"></uui-loader-bar>
            <p>Importing media, please wait...</p>
        </div>

        <!-- Requirements Card -->
        <div class="requirements-card" ng-if="!state.media.loading">
            <div class="card-header">
                <div class="icon-circle blue">‚Ñπ</div>
                <div>
                    <h2>Requirements & Help</h2>
                    <span class="subtitle">Everything you need to format your media import file correctly</span>
                </div>
            </div>
            <div class="card-body">
                <!-- Upload Options -->
                <div class="req-section">
                    <div class="req-label">Upload Options</div>
                    <div class="media-tips">
                        <div class="media-tip">
                            <div class="tip-icon">üì¶</div>
                            <strong>ZIP file:</strong> Contains CSV and media files referenced in it
                        </div>
                        <div class="media-tip">
                            <div class="tip-icon">üìÑ</div>
                            <strong>CSV only:</strong> For URL or file path imports
                        </div>
                    </div>
                </div>

                <!-- Required Columns -->
                <div class="req-section">
                    <div class="req-label">Required CSV Columns (depends on import type)</div>
                    <div class="req-grid">
                        <div class="req-item">
                            <code>fileName</code>
                            <div class="desc">For ZIP uploads: path to file within ZIP</div>
                            <div class="examples">
                                <span>image.jpg</span>
                                <span>photos/pic.png</span>
                            </div>
                        </div>
                        <div class="req-item">
                            <code>mediaSource|urlToStream</code>
                            <div class="desc">For URL imports</div>
                            <div class="examples">
                                <span>https://...</span>
                            </div>
                        </div>
                        <div class="req-item">
                            <code>mediaSource|pathToStream</code>
                            <div class="desc">For file path imports</div>
                            <div class="examples">
                                <span>C:\Images\...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Optional Columns & Features -->
                <div class="req-section">
                    <div class="req-label">Optional Features</div>
                    <div class="media-tips">
                        <div class="media-tip">
                            <div class="tip-icon">üìÅ</div>
                            <code>parent</code> column for folder ID/GUID/path (auto-creates folders)
                        </div>
                        <div class="media-tip">
                            <div class="tip-icon">üè∑</div>
                            <code>name</code> and <code>mediaTypeAlias</code> (auto-detected if omitted)
                        </div>
                        <div class="media-tip">
                            <div class="tip-icon">üë•</div>
                            Multi-CSV imports with automatic media deduplication
                        </div>
                        <div class="media-tip">
                            <div class="tip-icon">‚ú®</div>
                            Custom properties like <code>altText</code>, <code>caption</code>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ClerksWell Branding Footer -->
    <footer class="plugin-footer">
        <div class="divider"></div>
        <a href="https://www.clerkswell.com" target="_blank" rel="noopener noreferrer" class="brand-link">
            Made for the Umbraco Community with
            <span class="heart">‚ù§Ô∏è</span>
            from
            <img src="/App_Plugins/BulkUpload/images/cw-logo-primary-blue.png" alt="ClerksWell" />
        </a>
    </footer>
</div>
